package com.wk;import com.alibaba.excel.ExcelWriter;import com.alibaba.excel.metadata.Sheet;import com.alibaba.excel.metadata.Table;import com.alibaba.excel.support.ExcelTypeEnum;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import org.apache.commons.lang3.StringUtils;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.RestController;import javax.servlet.ServletOutputStream;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.File;import java.io.IOException;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Date;import java.util.List;@RestControllerpublic class ExcelController {//    @GetMapping("/a")    @RequestMapping(value = "/a", method = RequestMethod.GET)    public void cooperation(HttpServletRequest request, HttpServletResponse response, String name)            throws IOException {        ServletOutputStream out = response.getOutputStream();//        String[] strings = name.split(".");//        if (strings != null) {//            name = strings[0];//        }//        String fileName =  name + new String((new SimpleDateFormat("yyyy-MM-dd").format(new Date()))//                .getBytes(), "UTF-8");        String fileName = name.replaceAll(".json","");        response.setContentType("multipart/form-data");        response.setCharacterEncoding("utf-8");        response.setHeader("Content-disposition", "attachment;filename=" + fileName + ".xlsx");        ExcelWriter writer = new ExcelWriter(out, ExcelTypeEnum.XLSX, true);        Sheet sheet = new Sheet(1, 0);        List<List<String>> head = new ArrayList<List<String>>();        List<String> headCoulumn1 = new ArrayList<String>();        List<String> headCoulumn2 = new ArrayList<String>();        List<String> headCoulumn3 = new ArrayList<String>();        List<String> headCoulumn4 = new ArrayList<String>();        List<String> headCoulumn5 = new ArrayList<String>();        headCoulumn1.add("店家名称");        headCoulumn2.add("店铺评分");        headCoulumn3.add("月售");        headCoulumn4.add("人均");        headCoulumn5.add("配送费");        head.add(headCoulumn1);        head.add(headCoulumn2);        head.add(headCoulumn3);        head.add(headCoulumn4);        head.add(headCoulumn5);        Table table = new Table(1);        table.setHead(head);        sheet.setSheetName("下载数据");        writer.write0(getListString(), sheet, table);        writer.finish();        out.flush();    }    @RequestMapping(value = "/b", method = RequestMethod.GET)    public void cooperation2(HttpServletRequest request, HttpServletResponse response)            throws IOException {        String filepath = "/codes";//D盘下的file文件夹的目录        File file = new File(filepath);//File类型可以是文件也可以是文件夹//        File[] fileList = file.listFiles();//将该目录下的所有文件放置在一个File类型的数组中//        List<File> wjList = new ArrayList<File>();//新建一个文件集合        NameFilter filter = new NameFilter("json");        File[] files = file.listFiles(filter);        List<File> wjList = new ArrayList<File>();//新建一个文件集合        if(files != null) {  //判断文件是否存在，如果不存在而强行输出，则会报NullPointerException空指针异常的错误            for (File afile : files) {    //for each 循环输出文件名，不了解的可以搜一下，在集合处使用很多                if (afile != null) {                    wjList.add(afile);                    getJson(afile.getPath());                    cooperation(request,response,afile.getName());                }            }        }        for (File bfile : wjList){            getJson(bfile.getPath());            cooperation(request,response,bfile.getName());        }//        ServletOutputStream out = response.getOutputStream();//        String fileName = new String((new SimpleDateFormat("yyyy-MM-dd").format(new Date()))//                .getBytes(), "UTF-8");//        response.setContentType("multipart/form-data");//        response.setCharacterEncoding("utf-8");//        response.setHeader("Content-disposition", "attachment;filename=" + fileName + ".xlsx");//        ExcelWriter writer = new ExcelWriter(out, ExcelTypeEnum.XLSX, true);//        Sheet sheet = new Sheet(1, 0);//        List<List<String>> head = new ArrayList<List<String>>();//        List<String> headCoulumn1 = new ArrayList<String>();//        List<String> headCoulumn2 = new ArrayList<String>();//        List<String> headCoulumn3 = new ArrayList<String>();//        List<String> headCoulumn4 = new ArrayList<String>();//        List<String> headCoulumn5 = new ArrayList<String>();//        headCoulumn1.add("店家名称");//        headCoulumn2.add("店铺评分");//        headCoulumn3.add("月售");//        headCoulumn4.add("人均");//        headCoulumn5.add("配送费");//        head.add(headCoulumn1);//        head.add(headCoulumn2);//        head.add(headCoulumn3);//        head.add(headCoulumn4);//        head.add(headCoulumn5);//        Table table = new Table(1);//        table.setHead(head);//        sheet.setSheetName("下载数据");//        writer.write0(getListString(), sheet, table);//        writer.finish();//        out.flush();    }    ClassLoader classLoader = HelloJson.class.getClassLoader();    String path = classLoader.getResource("test1.json").getPath();//String filepath = "D:\file";//D盘下的file文件夹的目录//File file = new File(filepath);//File类型可以是文件也可以是文件夹//File[] fileList = file.listFiles();//将该目录下的所有文件放置在一个File类型的数组中//        for (int i = 0 ; i < shopList.size();i++){//        JSONObject key1 = (JSONObject)shopList.get(i);//        String name = (String)key1.get("shopName");//        System.out.println(name);////    }    private List<List<String>> getListString() {        String s = ReadUtil.readJsonFile(path);        JSONObject jobj = JSON.parseObject(s);        JSONObject data = jobj.getJSONObject("data");        JSONArray shopList = data.getJSONArray("shopList");        List<List<String>> result = new ArrayList<>();        for (int i = 0; i < shopList.size(); i++) {            List<String> item = new ArrayList<>();            JSONObject key1 = (JSONObject) shopList.get(i);            String name = (String) key1.get("shopName");            item.add(name);            JSONObject key2 = (JSONObject) shopList.get(i);            int wmPoiScore = (int) key2.get("wmPoiScore");            item.add(wmPoiScore + "");            JSONObject key3 = (JSONObject) shopList.get(i);            String monthSalesTip = (String) key3.get("monthSalesTip");            String[] strs = monthSalesTip.split("月售");            if (strs.length > 1) {                item.add(replaceMap(strs[1]));            }            JSONObject key4 = (JSONObject) shopList.get(i);            String averagePriceTip = (String) key4.get("averagePriceTip");            String[] averagePriceTips = averagePriceTip.split("人均 ¥");            if (averagePriceTips.length > 1) {                item.add(replaceMap(averagePriceTips[1]));            }//            JSONObject key5 = (JSONObject) shopList.get(i);//            String averagePriceTip = (String) key5.get("monthSalesTip");//            item.add(averagePriceTip);            result.add(item);        }        return result;    }    private static String replaceMap(String text) {        String replaceEach = StringUtils.replaceEach(text,                new String[]                        {                                "&#xe5f7;", "&#xe60d;", "&#xe616;",                                "&#xeb31;", "&#xe60d;", "&#xe616;",                                "&#xefda;", "&#xe60d;", "&#xe616;",                                "&#xee9b;", "&#xe60d;", "&#xe616;",                                "&#xf1b1;", "&#xe60d;", "&#xe616;",                                "&#xf026;", "&#xe60d;", "&#xe616;",                                "&#xe138;", "&#xe60d;", "&#xe616;",                                "&#xe8e1;", "&#xe60d;", "&#xe616;",                                "&#xea36;", "&#xe60d;", "&#xe616;",                                "&#xf323;", "&#xe60d;", "&#xe616;"                        },                new String[]                        {                                "0", "0", "0",                                "1", "1", "1",                                "2", "2", "2",                                "3", "3", "3",                                "4", "4", "4",                                "5", "5", "5",                                "6", "6", "6",                                "7", "7", "7",                                "8", "8", "8",                                "9", "9", "9"                        }        );        return replaceEach;    }    private void getJson(String path) {        String s = ReadUtil.readJsonFile(path);        JSONObject jobj = JSON.parseObject(s);        JSONObject data = jobj.getJSONObject("data");        JSONArray shopList = data.getJSONArray("shopList");        List<List<String>> result = new ArrayList<>();        for (int i = 0; i < shopList.size(); i++) {            List<String> item = new ArrayList<>();            JSONObject key1 = (JSONObject) shopList.get(i);            String name = (String) key1.get("shopName");            item.add(name);            JSONObject key2 = (JSONObject) shopList.get(i);            int wmPoiScore = (int) key2.get("wmPoiScore");            item.add(wmPoiScore + "");            JSONObject key3 = (JSONObject) shopList.get(i);            String monthSalesTip = (String) key3.get("monthSalesTip");            String[] strs = monthSalesTip.split("月售");            if (strs.length > 1) {                item.add(replaceMap(strs[1]));            }            JSONObject key4 = (JSONObject) shopList.get(i);            String averagePriceTip = (String) key4.get("averagePriceTip");            String[] averagePriceTips = averagePriceTip.split("人均 ¥");            if (averagePriceTips.length > 1) {                item.add(replaceMap(averagePriceTips[1]));            }//            JSONObject key5 = (JSONObject) shopList.get(i);//            String averagePriceTip = (String) key5.get("monthSalesTip");//            item.add(averagePriceTip);            result.add(item);        }    }}